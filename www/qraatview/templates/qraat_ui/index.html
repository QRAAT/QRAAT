<!-- File: qraat_ui/templates/index.html -->

<!DOCTYPE html>
<html>


<head>

    <title>QRAAT APP</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" type="text/css" href="/static/qraat_ui/css/style.css"/>
    <!-- Link google maps API with alisha's gmail key -->
    <script type="text/javascript" 
      src="https://maps.googleapis.com/maps/api/js?key={% load google_maps_api %}&sensor=false">
    </script>
    <link href="/static/flot/example.css" rel="stylesheet" type="text/css">
    <script src="/static/flot/jquery-1.11.1.min.js"></script>
    <script src="/static/flot/jquery.flot.min.js"></script>
    <script src ="/static/flot/jquery.flot.time.min.js"></script>
    <script src ="/static/flot/jquery.flot.selection.min.js"></script>
    <script src="/static/flot/jquery.flot.threshold.min.js"></script>
    <script src="/static/flot/jquery.flot.resize.min.js"></script>

<script>
    // Global variables
    var highlightedPoly;
    var selectedMarker;
    var map;
    var mapCenter;
    var markers = [];
	first_dep = {{graph_dep}};
	curr_dep = first_dep;
    markers_querydata = new Array();
    selectedMarkers = new Array();

function addSelectedPos(marker, map){
    /*Add a marker to a selected position point*/
	marker.selected = new google.maps.Marker({
		position: new google.maps.LatLng
		(
			marker.qraat_pos[8][0],
			marker.qraat_pos[8][1]
		),
		map: map,
		zIndex: google.maps.Marker.MAX_ZINDEX + 1
		// zIndex sets marker on top of all other markers
	});

	// Set on click infoWindow content for highlighted data marker
	addInfoWindow(marker.selected, marker.qraat_pos, map);

	for (var i =0; i < selectedMarkers.length; i++) {
		if(selectedMarkers[i].selected)
			selectedMarkers[i].selected.setMap(null);
		else
			selectedMarkers[i].setMap(null);
	}
	//Empty selected markers array
	selectedMarkers = new Array();

	selectedMarkers.push(marker);

	// Deployment changed need to reload flot
	if(marker.qraat_pos[1] != curr_dep){
		var marker = reloadFlot(markers_querydata, map, marker);
		curr_dep = marker.qraat_pos[1];
	}
	selectFlotPoint(marker);

}

function reloadFlot(markers, map, marker){
	var dep_id = marker.qraat_pos[1];
	plot.shutdown();
	$("placeholder2").unbind("plotclick");
	loadFlot(markers, map, dep_id);
	//Set the marker 
	for(var i=0; i<markers.length; i++){
		if(marker.qraat_pos[0] == markers[i].qraat_pos[0]){
			return markers[i];
		}
	}
}

function loadFlot(pos_markers, map, dep_id){
  //Loads flot graph

  var flot_clicked_series;
  var flot_clicked_datapoint;
  // Data arrays
  var d = new Array(); 
  var d1 = new Array();
  var d2 = new Array();
      var graph_dep = dep_id;
      var graph_data = {{graph_data}};
      var label, min, max;
      var deps = {{deps_list}};
      var graph_data_index;
      
      $("#dep_id").text(dep_id);

      // graph_data_index specifies column in pos_data to display in Flot. 
      if (graph_data ==2) { // activity 
        graph_data_index = 7;
	  }
      else{ // likelihood (default)
        graph_data_index = 6; 
      }

      //FIXME: bad smell hardcoded timestamp conversion
      // Should never NOT be null. Set even if GET request has no form data. 
        for (var i=0; i < pos_markers.length; i++) {
          if (pos_markers[i].qraat_pos[1] == graph_dep) {
            pos_markers[i].flot_index = i; 
            d1.push([pos_markers[i].qraat_pos[2]*1000-7*60*60*1000, pos_markers[i].qraat_pos[graph_data_index]]);
            d2.push([pos_markers[i].qraat_pos[2]*1000-7*60*60*1000, //timestamp
                    pos_markers[i].qraat_pos[graph_data_index], //activity or likelihood
                    pos_markers[i], // marker 
                    pos_markers[i].qraat_pos[1]]); // deploymentID
          } 
		  else{
		    pos_markers[i].flot_index = -1;	
		  }
        }

      var data =[ { data: d1, label: graph_dep, lines: {show:true} } ]
      
      var color = ["#8383FF", "yellow", "green", "#B00000"]

      for (i=0; i < deps.length; i++) {
        if (graph_dep == deps[i]) { var colorIndex = i; }
        //else { var colorIndex = 0; }
      }
      
      var options = {
        legend: { show: false },
        series: { lines: { show: true }, points: { show: false } },
        grid: { hoverable: true, clickable: true },
        xaxis: { mode: "time", timeformat: "%m-%d %H:%M"},
        highlightColor: 'red',
        selection: { mode: "xy" },
        colors: [ color[colorIndex] ]
      };

      plot = $.plot("#placeholder2", data, options);

      // Select maker in map when clicked on flot
      $("#placeholder2").bind("plotclick", function (event, pos, item) {
        if (item == undefined) return false;
      //uncomment to have this show up after enablePosition2 in the html (perhaps clickdata2?) 
      //$("#clickdata2").text("Index " + item.dataIndex +', Date/Time:'+item.datapoint[0]+', '+item.series.label + ': ' + item.datapoint[1]);
        
        //save clicked info in global variables
        flot_clicked_series = item.series;
        flot_clicked_datapoint = item.datapoint;
        
        clickedDateTime = item.dataIndex;
        addSelectedPos(d2[item.dataIndex][2], map);

      });
}

function selectFlotPoint(marker){
    plot.unhighlight();
    plot.highlight(0, marker.flot_index);
}

function addInfoWindow(marker, data, map){
    /*Add given data info to a given marker*/
    var content =   '<b>Deployment ID: </b>' + data[1] +
      '<br><b>Data ID: </b>' + data[0] + 
          '<br><b>Lat, Lon: </b> ' +
        data[8][0].toFixed(6) + ', ' +
    data[8][1].toFixed(6) +
      '<br><b>Easting, Northing, Zone: </b> ' + 
        data[3] + ', ' + 
        data[4] + ', ' + 
      data[5] +
          data[9] +
      '<br><b>Date/Time: </b>' + data[10] + 
        '<br><b>Activity: </b>' + data[7] +
    '<br><b>Likelihood: </b>' + data[6];

    var infoWindow = new google.maps.InfoWindow({content: content});
    
    // click Listener for markers
    google.maps.event.addListener(marker, 'click', 
      function (event)
        {
          infoWindow.open(map, this);
        } // end event function
    ); // end click Listener

}

function hideFormFields() {
  if ({{view_type|safe}} == "deployment") {
    document.getElementById('id_deployment').style.display = 'none';
    document.querySelector("label[for='id_deployment_0']").style.display = "none";
    document.getElementById('id_graph_dep').style.display = 'none';
    document.querySelector("label[for='id_graph_dep']").style.display = "none";
  }
}

window.onload = function() {
  hideFormFields();
};


function submitForm() {
  document.getElementById('form').submit();
}

// function setCenter is not working.
// It is intended to recenter the map on a button click.
function setCenter() { 
  map.panTo(new google.maps.LatLng(38.487828027, -122.149419006));
  //return false;
}

function initialize(){
    
    // Hard code the initial center latitude and longitude of the map 
    self.lat = 38.487828027;
    self.lng = -122.149419006;
    var myLatLng = new google.maps.LatLng(self.lat, self.lng);


// The following section saves the center and zoom for map reloads
  // otherwise, map would reset back to intial default center
  var reload_zoom;
  var mapOptions;

  // If: Map has been loaded before and bounds have changed
  // (this is when previous center and zoom are saved)...
  // Then: Set options to the the previous/saved center and zoom.
  if ((localStorage.mapLat != null) &&
      (localStorage.mapLng !=null) &&
      (localStorage.mapZoom !=null)) 
    {
      mapOptions = {
        center: new google.maps.LatLng(
          localStorage.mapLat, 
          localStorage.mapLng),
        zoom: parseInt(localStorage.mapZoom),
        mapTypeId: google.maps.MapTypeId.SATELLITE,
        
        panControl:true,
        zoomControl:true,
        mapTypeControl:true,
        scaleControl:true,
        streetViewControl:true,
        overviewMapControl:true,
        rotateControl:true
      }; // end map options
    } // end if map has been loaded before 


  // If: The map hasn't loaded before (nothing saved for center or zoom)...
  // Then: Set some default map options.
  else {
      var mapOptions = {
        center: myLatLng,
        zoom: 14, // Scale of 1 to 20
        mapTypeId: google.maps.MapTypeId.SATELLITE,
   
        panControl:true,
        zoomControl:true,
        mapTypeControl:true,
        scaleControl:true,
        streetViewControl:true,
        overviewMapControl:true,
        rotateControl:true
    }; // end map options
   } // end if map hasn't been loaded before

// Creates the map object, using the mapOptions set above
  var map = new google.maps.Map(document.getElementById("map-canvas"),
      mapOptions);

// Listen and store center & zoom changes, to be used in map options

    google.maps.event.addListener(map, "center_changed", function(){
      mapCenter = map.getCenter();
      localStorage.mapLat = mapCenter.lat();
      localStorage.mapLng = mapCenter.lng();
      localStorage.mapZoom = map.getZoom();
    });

    google.maps.event.addListener(map, "zoom_changed", function (){
      mapCenter = map.getCenter();
      localStorage.mapLat = mapCenter.lat();
      localStorage.mapLng = mapCenter.lng();
      localStorage.mapZoom = map.getZoom();
    });
    
    google.maps.event.addListener(map, "click", function(event) {
    document.getElementById('clicked_lat_lng').value = 
    event.latLng.lat().toFixed(6) + ', ' + event.latLng.lng().toFixed(6);
    });

// SHOW CLICKED DATA POINT INFO
  var django_position = {{pos_data|safe}}; // list of all queried data
  //var selected_data = {{selected_data|safe}}; // data for clicked point
  // Note: |safe enables strings to be passed from django/json to js

  // When google maps loads/refreshes, click 'button' to highlight 
  // Mousemove Listener to display lat, lng of mouse location
  
  google.maps.event.addListener(map,'mousemove',function(event){
    // Note:  Use '.value' for <input>, then data appears in a box
    //        Use '.innerHTML' for <span>
    document.getElementById('latlong').value = 
      event.latLng.lat().toFixed(6) + ', ' + 
      event.latLng.lng().toFixed(6);
  }); //end onemousemove event listener



  // Idle Listener. Displays bounds, center, and zoom
  
  google.maps.event.addListener(map, 'idle', function(){    
    
    // bounds
    document.getElementById('bounds').innerHTML = 
      'NE: '+this.getBounds().getNorthEast().lat().toFixed(6)+ ', ' +
            this.getBounds().getNorthEast().lng().toFixed(6)+
      ' | SW: '+this.getBounds().getSouthWest().lat().toFixed(6)+', '+
            this.getBounds().getSouthWest().lng().toFixed(6);
      
    // center
    document.getElementById('current_center').innerHTML = 
      this.getCenter().lat().toFixed(6)+', ' + 
      this.getCenter().lng().toFixed(6);
      
    // zoom
    document.getElementById('current_zoom').innerHTML = 
      this.getZoom();
  
  }); // end idle Listener



// If site markers are chosen to be shown...
  // Then populate locations array with site data. Later used for markers
  var site_checked = {{site_checked}};
  var site_list = {{siteslist|safe}};
  var locations = [];


  // Show site markers if site is checked in preferences
  if ((site_checked ==1) || ({{view_type|safe}} == "deployment")) {
    for (var i = 0; i < site_list.length; i++) {
      locations.push([
        site_list[i][3],  // [0]: site location lat
        site_list[i][4],  // [1]: site location lng
        site_list[i][0],  // [2]: site ID
        site_list[i][1],  // [3]: site name
        site_list[i][2],  // [4]: site location string
        site_list[i][9]   // [5]: site elevation
        ]);
    } // end if site checked
  } // end looping through list of sites


  else {  // if sites are not checked, just push an empty list
    locations.push([]);
  }


// SET MARKERS: 
  var marker, i;
  var markers_sites = new Array();
  var infoWindows_sites = new Array();

  // Display markers for site locations
  for (i = 0; i < locations.length; i++) {
    
    marker = new google.maps.Marker({
      position: new google.maps.LatLng(locations[i][0], locations[i][1]),
      map: map,
      icon: 'http://maps.google.com/mapfiles/ms/micons/green-dot.png',
      infoWindowIndex: i
    });   // end the setting of marker data to be pushed to array
    
    // Set infoWindow content
    if (locations.length>0) {
      var content = '<b>Site ID:</b> ' + locations[i][2] + 
                    ' or "' + locations[i][3]+'"' + 
                    '<br><b>Location:</b> ' + locations[i][4] + ', ' + 
                    '(' + locations[i][0] + ', ' + locations[i][1] + 
                    ')<b><br>Elevation:</b> ' + locations[i][5];
    }
    var infoWindow = new google.maps.InfoWindow({content: content});
    
    // click Listener for markers
    var clickedInfoWindowIndex;
    google.maps.event.addListener(marker, 'click', 
      function (event)
        {
          // Note: The following pans to point:
          // map.panTo(event.latLng);
          
          // If a site infoWindow is already open, close it.
          if (clickedInfoWindowIndex != null) {
            infoWindows_sites[clickedInfoWindowIndex].close();
          }
          
          // Open infoWindow for clicked site location
          infoWindows_sites[this.infoWindowIndex].open(map, this);
          clickedInfoWindowIndex = this.infoWindowIndex;
        } // end event function
    ); // end click Listener

    // push to the marker and infoWindow arrays for the site locations
    markers_sites.push(marker);
    infoWindows_sites.push(infoWindow);
  
  } //end for loop for site locations

// Display markers for the data points 
 
  var infoWindows_querydata = new Array();    
  var position_data = {{pos_data|safe}};
  var display_type = {{display_type}};

  // Display marker points if html pref is set to display them
 //Uncommenting to show on public
  var deps = {{deps_list}};
 
 if ( ((display_type != null) && (display_type==1) && 
      (position_data.length > 0))
      ||
      ({{view_type|safe}} == "deployment") && (display_type!=2)) {
    
    for (i=0; i < position_data.length-1; i++) {
      marker = new google.maps.Marker({
        position: new google.maps.LatLng(
          position_data[i][8][0], position_data[i][8][1]),
        map: map,
        //icon: 'http://www.geocodezip.com/mapIcons/small_blue_dot.png',
        infoWindowIndex: i
      });

//Hard code colors for markers. If dep in array == req_deps from views, display it as a marker of a certain color.
      if ( ({{view_type|safe}} == "deployment") || 
        ( (deps.length > 0) && (position_data[i][1] == deps[0]) ) ) {
    marker.setIcon('http://www.geocodezip.com/mapIcons/small_blue_dot.png')
      }
      if ((deps.length > 1) && (position_data[i][1] == deps[1])) {
  marker.setIcon('http://www.geocodezip.com/mapIcons/small_yellow_dot.png')
      }
      if ((deps.length > 2) && (position_data[i][1] == deps[2])) {
  marker.setIcon('http://www.geocodezip.com/mapIcons/small_green_dot.png')
      }
     if ((deps.length > 3) && (position_data[i][1] == deps[3])) {
  marker.setIcon('http://www.geocodezip.com/mapIcons/small_red_dot.png')
      }
  
      var content = '<b>DeploymentID: </b>' + position_data[0][1] + 
                    '<br>' + position_data[i][8][0].toFixed(5)
                    + ', ' + position_data[i][8][1].toFixed(5)+
                    '<br><b>PosID:</b> ' + position_data[i][0] + 
                    '<br><b>Time:</b> ' + position_data[i][10] +
                    '<br><b>Activity:</b> ' + position_data[i][7] + 
                    '<br><b>Likelihood:</b> ' + position_data[i][6];
        
      var infoWindow = new google.maps.InfoWindow({ content: content, 
          //Uncomment the following lines for infoWindow options
          //size: new google.maps.Size(150, 50),
          disableAutoPan: true
          });
      
    marker.qraat_pos = position_data[i];
    google.maps.event.addListener(marker, 'click',
        function(){ 
        // WHEN MAP IS CLICKED, display another marker there to highlight point
          addSelectedPos(this, map);
      }); // end event function and marker event listener
      
    // on mousing over markers for data points, open them to show lat/lng
    google.maps.event.addListener(marker, 'mouseover', function() {
      
      //Uncomment next line to show pop-up infowindows when mousing over marker data points
      //infoWindows_querydata[this.infoWindowIndex].open(map, this);

    //mouseover markers to show info in html sidebar
    //TODO: Try to put pos date into marker obj
    document.getElementById('selected_point_latlon').innerHTML = 
      position_data[this.infoWindowIndex][8][0].toFixed(6) + ', ' +
      position_data[this.infoWindowIndex][8][1].toFixed(6); 
        // lat,lng of point in db
    document.getElementById('selected_point_eastingnorthing').innerHTML = 
      position_data[this.infoWindowIndex][3] + ', ' +   // easting 
      position_data[this.infoWindowIndex][4] + ', ' +   // northing
      position_data[this.infoWindowIndex][5] + ' ' +    // zone number
      position_data[this.infoWindowIndex][9];          // zone letter
    document.getElementById('selected_point_date').innerHTML = 
      position_data[this.infoWindowIndex][10];// datestring timestamp
    document.getElementById('selected_point_activity').innerHTML = 
      position_data[this.infoWindowIndex][7].toFixed(6);  // activity
    document.getElementById('selected_point_likelihood').innerHTML = 
      position_data[this.infoWindowIndex][6].toFixed(6); // likelihood
    document.getElementById('selected_point_positionID').innerHTML = 
      position_data[this.infoWindowIndex][0];
    document.getElementById('selected_point_deployment').innerHTML = 
      position_data[this.infoWindowIndex][1];
    }); // end mouseover event function

    google.maps.event.addListener(marker, 'mouseout', function() {
    document.getElementById('selected_point_latlon').innerHTML = "" 
    document.getElementById('selected_point_eastingnorthing').innerHTML = "" 
    document.getElementById('selected_point_date').innerHTML = ""
    document.getElementById('selected_point_activity').innerHTML = "" 
    document.getElementById('selected_point_likelihood').innerHTML = ""
    document.getElementById('selected_point_positionID').innerHTML = ""
    document.getElementById('selected_point_deployment').innerHTML = ""
  
    }); // end mouseout event function

    // close infowindows on mousing out of marker
    google.maps.event.addListener(marker, 'mouseout', function() {
      infoWindows_querydata[this.infoWindowIndex].close();
    }); // end mouseout event function
        infoWindows_querydata.push(infoWindow);
        markers_querydata.push(marker);
    } //end for loop for query data
    loadFlot(markers_querydata, map, curr_dep);
  } //end if statement for displaying query data as points (not lines)



// DISPLAY MARKER / "HIGHLIGHT" SELECTED POINT (clicked in maps or in flot)

//FIXME: Took reloadflot from here
// WHEN HTML PREF IS SET TO 'Lines':

  if ((display_type != null) && (display_type == 2)) {
  // Populate data for the Polyline
    var position_data = {{pos_data|safe}};
    var flightPlanCoordinates = new Array();
    
    for (i=0; i < position_data.length-1; i++) {
      var point = new google.maps.LatLng(
        position_data[i][8][0], position_data[i][8][1]);
      flightPlanCoordinates.push(point);
    } // end for loop through queried data points
    
 // Draw the polyline
    var flightPath = new google.maps.Polyline({
      path: flightPlanCoordinates,
      infoWindowIndex: i,
      geodesic: true,
      strokeColor: '#8383FF',
      strokeOpacity: 1.0,
      strokeWeight: 2
    }); // end drawing the Polyline


    flightPath.setMap(map);
    
  google.maps.event.addListener(flightPath, 'mouseover', function(event) {
    
    //Attempt to get the index of the closest point to the mouse location
    var vertex;
    var i;
    for (i=0; i < position_data.length; i ++) {
      if ((event.latLng.lat().toFixed(3) == position_data[i][8][0].toFixed(3)) && (event.latLng.lng().toFixed(3) == position_data[i][8][1].toFixed(3))) { vertex = i; }
    }

    if (vertex != null) {
    document.getElementById('selected_point_latlon').innerHTML = 
      position_data[vertex][8][0].toFixed(6) + ', ' +
      position_data[vertex][8][1].toFixed(6);          
        // lat, lng of actual point in db
    document.getElementById('selected_point_eastingnorthing').innerHTML = 
      position_data[vertex][3] + ', ' +   // easting 
      position_data[vertex][4] + ', ' +   // northing
      position_data[vertex][5] + ' ' +    // zone number
      position_data[vertex][9];          // zone letter
    document.getElementById('selected_point_date').innerHTML = 
      position_data[vertex][10];          // date string of timestamp
    document.getElementById('selected_point_activity').innerHTML = 
      position_data[vertex][7].toFixed(6);  // activity
    document.getElementById('selected_point_likelihood').innerHTML = 
      position_data[vertex][6].toFixed(6); // likelihood
    document.getElementById('selected_point_positionID').innerHTML = 
      position_data[vertex][0];
    document.getElementById('selected_point_deployment').innerHTML = 
      position_data[vertex][1];
  } // end if vertex
  
  }); // end event mouseover eventListener


    google.maps.event.addListener(flightPath, 'mouseout', function() {
    document.getElementById('selected_point_latlon').innerHTML = "" 
    document.getElementById('selected_point_eastingnorthing').innerHTML = "" 
    document.getElementById('selected_point_date').innerHTML = ""
    document.getElementById('selected_point_activity').innerHTML = "" 
    document.getElementById('selected_point_likelihood').innerHTML = ""
    document.getElementById('selected_point_positionID').innerHTML = ""
    document.getElementById('selected_point_deployment').innerHTML = ""
  
    }); // end mouseout event function
    
  google.maps.event.addListener(flightPath, 'click', function(event) {
    //Attempt to get the index of the closest point to the mouse location
    var vertex;
    var i;
    for (i=0; i < position_data.length-1; i ++) {
      if ((event.latLng.lat().toFixed(2) == position_data[i][8][0].toFixed(2)) && (event.latLng.lng().toFixed(2) == position_data[i][8][1].toFixed(2))) { vertex = i; }
  }

  if (vertex != null) {
          marker.setMap(null); 
    
    //if (marker){
    //  marker.setMap(null);
  
      // There is a bug; when a point is clicked in flot, 
      //the marker stays there when a point in google maps is clicked too. 
      //The Lines click in maps doesn't get passed to flot either 
      //because the html form input for lat_clicked and lng_clicked
      //are not submitted to calculate index for selected_data
      //Also, the map doesn't reload so the marker stays there.
      //need to figure out how to set markers declared elsewhere to "null"

      //selectedMarkers.setMap(null);
   // }

    marker = new google.maps.Marker({
      position: new google.maps.LatLng
        (
        position_data[vertex][8][0], 
        position_data[vertex][8][1]
        ),
      map: map,
      zIndex: google.maps.Marker.MAX_ZINDEX + 1
      // zIndex sets marker on top of all other markers
      
      // Note: When no icon, uses default large/red marker
      // icon: 'http://maps.google.com/mapfiles/ms/micons/red-dot.png'
    }); // end setting marker data


    // Set on click infoWindow content for highlighted data marker
    var content = '<b>Deployment ID: </b>' + position_data[vertex][1] +
            '<br><b>Data ID: </b>' + position_data[vertex][0] + 
            '<br><b>Lat, Lon: </b> ' +
            position_data[vertex][8][0].toFixed(6) + ', ' +
            position_data[vertex][8][1].toFixed(6) +
            '<br><b>Easting, Northing, Zone: </b> ' + 
            position_data[vertex][3] + ', ' + 
            position_data[vertex][4] + ', ' + 
            position_data[vertex][5] +
            position_data[vertex][10] +
            '<br><b>Date/Time: </b>'  + position_data[vertex][9] + 
            '<br><b>Activity: </b>' +  position_data[vertex][7] +
            '<br><b>Likelihood: </b>' + position_data[vertex][6];

    var infoWindow = new google.maps.InfoWindow({content: content});
    
    
  // click Listener for markers
    google.maps.event.addListener(marker, 'click', 
      function (event)
        {
          infoWindow.open(map, this);
        } // end event function
    ); // end click Listener
  

    //Populate the html sidebar with related data

    document.getElementById('selected_point_latlon').innerHTML = 
      position_data[vertex][8][0].toFixed(6) + ', ' + // lat of actual pt in db
      position_data[vertex][8][1].toFixed(6);          // lng of point in db
    document.getElementById('selected_point_eastingnorthing').innerHTML = 
      position_data[vertex][3] + ', ' +   // easting 
      position_data[vertex][4] + ', ' +   // northing
      position_data[vertex][5] + ' ' +    // zone number
      position_data[vertex][9];          // zone letter
    document.getElementById('selected_point_date').innerHTML = 
      position_data[vertex][10];          // date string of timestamp
    document.getElementById('selected_point_activity').innerHTML = 
      position_data[vertex][7].toFixed(6);  // activity
    document.getElementById('selected_point_likelihood').innerHTML = 
      position_data[vertex][6].toFixed(6); // likelihood
    document.getElementById('selected_point_positionID').innerHTML = 
      position_data[vertex][0];
    document.getElementById('selected_point_deployment').innerHTML = 
      position_data[vertex][1];
  } // end if vertex
  
  }); // end event mouseover eventListener

              // Polyline for Deployment 2


  } // end if (html pref is set to show data as lines)
 
    // Example of addListeners for the flightPath
      // On mouseover, the flightPath changes color
      
      //google.maps.event.addListener(flightPath, 'mouseover', function() {
        //flightPath.setOptions({strokeColor: '#00FFaa'});
      //});
      //google.maps.event.addListener(flightPath, 'mouseout', function () {
        //flightPath.setOptions({strokeColor: '#FF00FF'});
      //});


    // Attempt at 2nd Polyline 
      // var flight_track = {{track_list}};
      // var flightPlanCoordinates2 = new Array();
      // for (i=0; i < flight_track.length-1; i++)
      // {
      //   var point2 = new google.maps.LatLng(
      //    flight_track[i][8][0], flight_track[i][8][1]);
      //   flightPlanCoordinates2.push(point);
      // }

    // Draw 2nd blue polyline
      // var flightPath2 = new google.maps.Polyline({
      //   path: flightPlanCoordinates2,
      //   geodesic: true,
      //   strokeColor: '#0000FF',
      //   strokeOpacity: 1.0,
      //   strokeWeight: 1});

    // flightPath2.setMap(map);

} //end function initialize

// Load google maps on browser window load
google.maps.event.addDomListener(window, 'load', initialize);

                            //FLOT GRAPH

</script>

</head>

<body>


<div id = "text" style="background-color: #E8E8E8; padding-right: 10px; margin-right: -10px;">

<center>
<div id="page_title"><a href='/'>QRAAT Home</a></div>
 <!--onclick='initialize(38.487828027, -122.149419006, 14);'-->
<!-- <a href="index.html" target="export">Export view as .kml</a><br>-->
</center>
<br />

<div class="section_title">PREFERENCES
<button onclick="submitForm()">Submit Form</button></div>
<div id ="prefs">

<form id="form" action ="" name="settings" method="get">
<!-- <input type="submit" value="SUBMIT PREFERENCES" /> -->
<font size="2">
{% for field in form %}

{% if field.auto_id = "id_deployment"  or field.auto_id = "id_likelihood_low" or field.auto_id = "id_activity_low" %}
<b>{{field.label_tag}}</b> {{field}}

{% elif field.auto_id = "id_sites" %}
<b>{{field.label_tag}}</b> {{field}}<br><br>
<b><u>FILTER DATA BY:</u></b>
<br><font size="1">Date/Time Format: YYYY-MM-DD HH:MM:SS (24hr)</font><br>

{% elif field.auto_id = "id_activity_high" %}
<b>{{field.label_tag}}</b> {{field}}<br><br>


<b><u>GRAPH:</u></b><br>

{% else %}
<b>{{field.label_tag}}</b> {{field}}<br>
{% endif %}
{% endfor %}
</font>

</form>

<!-- <font size="1">date range: 2013-08-13  13:57:16 to 2014-06-16 14:28:12</font> -->
</div><!-- end prefs -->

<br>

<script type="text/javascript">
</script>

<div class="section_title">MAP INFO</div>
<div id="mouseover">
<font size="2">
<!-- View Type: {{view_type}} <br>-->
{% if positions %}
<b>No. of points displayed</b>: {{positions|length}}

{% if deps|length > 1 %} <br><b>Line Colors: Blue</b>: {{deps.0}} | <b>Yellow:</b> {{deps.1}}{% endif %}
{% if deps|length > 2 %} | <b>Green:</b> {{deps.2}}{% endif %}
{% if deps|length > 3 %} | <b>Red:</b> {{deps.3}}{% endif %}
<br>

{% endif %} <!-- endif for positions -->

<b>Mouseover Lat, Lon: </b> <input type="text" class="current_info" id="latlong" style="width:150px; border:1px inset black;"></span>
<!--<br><b>Clicked Lat, Lon: </b>--><input type="hidden" class="current_info" id="clicked_lat_lng" style="width:150px; border:1px inset black;"></span>
<br><b>Map Bounds: <font size="1"></b><span id="bounds"></span></font>
<br><b>Map Center: </b><span id="current_center"></span>
<br><b>Map Zoom: </b><span id="current_zoom"></span>
<!--<br><b>Clicked Lat, Long: </b> <input type="text" id="latlongclicked" style="width:300px; border:1px inset black;"></span> -->
<br></font>
</div>
<br>

<div class="section_title">DATA FOR MOUSED-OVER POSITION</div>

<div id="clicked">
<font size="2">
{% if selected_message%}
 {% if flot_index == None %}
<br><center><i>{{selected_message}}</i></center>
  {% endif %}
{% endif %}

<b>Deployment ID: </b><span id="selected_point_deployment"></span>
<br><b>Data Point ID: </b><span id="selected_point_positionID"></span>
<br>
<br><b>Lat, Lon: </b><span id="selected_point_latlon"></span>
<br><b>Easting, Northing, Zone: </b><span id="selected_point_eastingnorthing"></span>
<br>
<br><b>Date & Time: </b><span id="selected_point_date"></span>
<br><b>Position Likelihood: </b><span id="selected_point_likelihood"></span>
<br><b>Animal Activity: </b><span id="selected_point_activity"></span>

</font>
</div> <!-- end clicked -->
</div> <!-- end text -->

<!-- right side -->
<div id="map-canvas"></div>

{% if positions %}
<!-- FLOT CHART -->
<div id="right_side">
  <div id="content">
  <center>
  {% if graph_data == "1" or graph_data == "null" %}
  <b><u>LIKELIHOOD vs. TIME</u></b>
  <br>Deployment Shown = 
  {% if graph_dep_django %}
	<span id="dep_id"></span>
  {% else %}
  {{deps.0}}
  {% endif %}

  {% endif %}

  {% if graph_data == "2" %}
  <b><u>ACTIVITY vs. TIME</u></b>
  <br>Deployment Shown = <span id="dep_id"></span> 
  {% endif %}

<!--Uncomment next line to display index, time, and data from clicking the flot chart -->
<!-- <span id ="enablePosition2">Clicked: </span> -->
  <!-- <p><label><input id="enablePosition2" type="checkbox" checked="checked"></input>Clicked: </label>  -->
  <span id="hoverdata2"></span>
  <span id="clickdata2"></span>
  <!-- <p><label><input id="enableTooltip2" type="checkbox" checked="checked"></input>Enable tooltip</label></p>  -->
<br>
<div id="right_side2">
<!-- 2ND FLOT CHARTS -->

<div id="content2">
  <!-- sets the width of the total container of both the main graph and the small overview graph -->
  <div class="demo-container2" style="width:650px; height: 200px;">
  <!-- sets the width of the main/large graph -->
  <div id="placeholder2" class="demo-placeholder" style="float:left; width:650px; height: 200px;"></div>

<!-- uncomment next line for small overview graph -->
<!--   <div id="overview" class="demo-placeholder" style="float: right; width: 100px; height: 125px;"></div> -->
 
  </div>
</div> <!-- end div right_side2 -->

{% endif %} <!-- end if positions (if there is query data) -->
</body>
</html>
