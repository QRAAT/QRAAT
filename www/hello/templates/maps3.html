<!DOCTYPE html>
<html>
<head>
  <title>Test Map App</title>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
  <style type="text/css">
    html { height: 100% }
    body { height: 100%; margin: 5; padding: 0 }
    #map-canvas { margin-top: 1cm; height: 70%; width: 70%; float: right; }
    #text {width: 28%; height: 90%; float: left }
    #prefs {border-style:solid; border-width: 1px; height: 40%; overflow: scroll; }
    #mouseover {border-style:solid; border-width: 1px; height: 40%; overflow: scroll;}
    #chart_div {float: left; }
    #chart_div2 {float: right; }
    #chart {float: right; }
  </style>

<script type="text/javascript"
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAPB3_yj11lEK6uSAthSd0Btv-E1FJqt3I">
</script>

<script type="text/javascript">
//  function getParams() {
//    String.prototype.q2obj = function(){
//      var qArr = this.split('&')
//          ,qObj = {}
//          ,i =-1;
//      while(++i<qArr.length) {
//              qfrag = qArr[i].split('=');
//              qObj[qfrag[0]] = qfrag[1];
//      }
//      return qObj;
//      };
//      //usage
//      var queryObj = location.search.substr(1).q2obj();
//  }

  function initialize() {
    self.lat = 38.4897343239;
    self.lng = -122.145749745;
    //self.lat = 38.479385;
    //self.lng = -122.142365;
    var myLatLng = new google.maps.LatLng(self.lat, self.lng);

    var mapOptions = {
      center: myLatLng,
      zoom: 15,
      mapTypeId: google.maps.MapTypeId.SATELLITE,
   
       panControl:true,
       zoomControl:true,
       mapTypeControl:true,
       scaleControl:true,
       streetViewControl:true,
       overviewMapControl:true,
       rotateControl:true
   };

    var map = new google.maps.Map(document.getElementById("map-canvas"),
      mapOptions);
    
    var contentString = '<div id="content"><h3>Mouse1</h3>'+
    '<p id="description">Mouse 1 is located at '+myLatLng+'.</p>';
    var infowindow = new google.maps.InfoWindow({
      content: contentString
    });

    var marker = new google.maps.Marker({
      position: myLatLng,
      map: map,
      draggable:false,
      title:"Quail Ridge Reserve"
    });


    var latslns = "{{ latlon }}"


    var flightPlanCoordinates = 
      //static points to draw lines
      [
      new google.maps.LatLng(38.483052, -122.149580),
      new google.maps.LatLng(38.499708, -122.148620),
      new google.maps.LatLng(38.499326, -122.139744),
      new google.maps.LatLng(38.491643, -122.152812),
      new google.maps.LatLng(38.491915, -122.136299),
      new google.maps.LatLng(38.492924, -122.142340),
      new google.maps.LatLng(38.483052, -122.149580),
      new google.maps.LatLng(38.495187, -122.151417),
      new google.maps.LatLng(38.493453, -122.148040),
      ];
      //note that the last point is actually the center for position estimation

      // django way to loop through each lat/lon from dict in models (add)
      //{% for key, value in latlon.items %}
      // new google.maps.LatLng({{ key }}, {{ value }}),
      //{% endfor %}
      //];


    var flightPath = new google.maps.Polyline({
      path: flightPlanCoordinates,
      geodesic: true,
      strokeColor: '#FF0000',
      strokeOpacity: 1.0,
      strokeWeight: 2});

    flightPath.setMap(map);

    google.maps.event.addListener(marker, 'click', function() {
      infowindow.open(map,marker);
     });
 
 //show alert
    google.maps.event.addDomListener(map, 'click', showAlert)

  } //end function initialize

google.maps.event.addDomListener(window, 'load', initialize);

//show alert
function showAlert() {
  window.alert("hi");
  }


function show_latlng() {
    var newlat = document.getElementById("lat").value;
    var newlng = document.getElementById("lng").value;
    self.newlat = newlat;
    self.newlng = newlng;
    //alert(newlat+', '+newlng);
    document.getElementById("display").innerHTML = 
      'Currently located at (Latitude, Longitude): <b>('
      +self.newlat+', '+self.newlng+')</b>.';
  }

 // function re_create_map() {
 //   var newlatlng = new google.maps.LatLng(document.getElementById("lat").value,document.getElementById("lng").value);
 //   center = newlatlng; 
</script>




<!--Chart -->

<script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">
    google.load("visualization", "1", {packages:["corechart"]});
    google.setOnLoadCallback(drawChart);
    function drawChart() {
      var data1 = google.visualization.arrayToDataTable([
        ['Year', 'Mouse1', 'Mouse2'],
        ['2004',  1000,      400],
        ['2005',  1170,      460],
        ['2006',  660,       1120],
        ['2007',  1030,      540]
      ]);
      var options1 = {
          'title': 'Activity',
          'width': 400,
          'height': 200
      };

      var data2 = google.visualization.arrayToDataTable([
        ['Time', 'Mouse2', 'Mouse2'],
        ['12:00',  10,      20],
        ['3:00',  20,      40],
        ['6:00',  34,       20],
        ['9:00',  103,      54]
      ]);
      var options2 = {
          'title': 'Prob',
          'width': 400,
          'height': 200
      };


      var chart1 = new google.visualization.LineChart(document.getElementById('chart_div'));
      var chart2 = new google.visualization.LineChart(document.getElementById('chart_div2'));

      //interactive selection ???
    //function myClickHandler(){
    //  var selection = myVis.getSelection();

    //  for (var i = 0; i < selection.length; i++) {
    //    var item = selection[i];
    //    if (item.row != null && item.column != null) {
    //      message += '{row:' + item.row + ',column:' + item.column + '}';
    //    } else if (item.row != null) {
    //      message += '{row:' + item.row + '}';
    //    } else if (item.column != null) {
    //      message += '{column:' + item.column + '}';
    //    }
    //  }
    //  if (message == '') {
    //    message = 'nothing';
    //  }
    //  alert('You selected ' + message);
   // }
      
      
      chart1.draw(data1, options1);
      chart2.draw(data2, options2);
    }
</script>

</head>





<body>
<!-- 
  <form name="latlng" onClick="show_latlng()" method="get">
  {% comment %} <form name="latlng" action="/maps3.html" method="post">
  {% csrf_token %} {% endcomment %}
  <h3>Enter a latitute and longitude: </h3>
  <label>Latitude:</label> <input type="text" name="lat" id="lat"><br />
  <label>Longitude:</label> <input type="text" name="lng" id="lng"><br />
  <input type="submit" value="Submit">
  </form>
-->
<div id = "text">
<center><h1><a href="/maps3.html">Map App</a></h1>
<p><a href="convert.html">export .kml</a></p>
</center>

<div id ="prefs">
<h3><center>SET PREFERENCES</center></h3>
<form action="/maps3.html" method="get">
  <b>Enter a database table name:</b><br/ >
  <input type="radio" name="dat" value="sitelist">sitelist<br />
  <input type="radio" name="dat" value="track">track<br />
  <input type="radio" name="dat" value="Position">Position<br />
<input type="submit" value="Submit">
</form>

<form action="/maps3.html" method="get">
  <br /><b>Enter a date & time range:</b><br />
  Date From: <input type"date" name="datefrom" value="YYYY-MM-DD"><br />
  Time From: <input type="time" name="timefrom" value="HH:MM">
  <select>
    <option name="fromampm" value="AM">AM</option>
    <option name="fromampm" value="PM">PM</option>
  </select><br /><br />

  Date To: <input type"date" name="dateto" value="YYY-MM-DD"><br />
  Time To: <input type="time" name="timefrom" value="HH:MM">
  <select>
    <option name="toampm" value="AM">AM</option>
    <option name="toampm" value="PM">PM</option>
  </select><br />

  <input type="submit" value="Submit">
</form><br /><br />
</div>
<br />

<div id="mouseover">
<h3><center>MOUSEOVER INFO</center></h3>
<table border="1" style="width=300px">
<tr>Lat:</tr>
<tr><br />Long:</tr>
<tr><br />Easting:</tr>
<tr><br />Northing:</tr>
<tr><br />Date:</tr>
<tr><br />Time:</tr>
<tr><br />Activity:</tr>
<tr><br />Prob. of position:</tr>
<tr><br />Animal ID:</tr>
</table>
</div>

<br />
<b>Database values from query:</b><br />
{% for key, value in latlon.items %}
 Lat_{{ forloop.counter }}: {{ key }}<br />
 Lng_{{ forloop.counter }}: {{ value }}<br />
{% endfor %}
</div>


<p id="display"></p>


<div id="map-canvas">

</div>
<br />



<div id="chart_div"></div>
<div id="chart_div2"></div>

<div id="chart">
Activity Chart (static image)<br/ >
<img src="../static/hello/linegraph.gif" width="400" height="200">
</div>




</body>
</html>
